<html lang=”en”>

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Name of your awesome camera app -->
    <title>Camera App</title>
</head>

<body>
    <!-- Camera -->
    <!-- <main id="camera">
        <canvas id="camera--sensor"></canvas>
        <video id="camera--view" autoplay playsinline></video>
        <img src="//:0" alt="" id="camera--output">
        <button id="camera--trigger">Take a picture</button>
    </main> -->

    <div id="camera">
            <canvas id="camera--sensor"></canvas>
    </div>
    
    <!-- Reference to your JavaScript file -->
    <script src="adapter.js"></script>
    <script src="https://unpkg.com/javascript-barcode-reader/dist/javascript-barcode-reader.min.js"></script>


    <script>


        


        var constraints = {
            video: {
                facingMode: "environment" // "environment" para a camera de tras
            }, audio: false
        };

        const cameraView = document.querySelector("#camera--view"),
            cameraOutput = document.querySelector("#camera--output"),
            cameraSensor = document.querySelector("#camera--sensor"),
            cameraTrigger = document.querySelector("#camera--trigger");


        function cameraStart() {
            
            navigator.mediaDevices
                .getUserMedia(
                    constraints
                    )
                .then(function (stream) {
                    track = stream.getTracks()[0];
                    cameraView.srcObject = stream;
                })
                .catch(function (error) {
                    alert('error' + Object.keys(error));
                    console.error("Oops. Something is broken.", error);
                });
        }

        cameraTrigger.onclick = function () {
            cameraSensor.width = cameraView.videoWidth;
            cameraSensor.height = cameraView.videoHeight;
            cameraSensor.getContext("2d").drawImage(cameraView, 0, 0);
            cameraOutput.src = cameraSensor.toDataURL("image/webp");
            cameraOutput.classList.add("taken");
            javascriptBarcodeReader(
                cameraSensor /* Image file Path || {data: pixelArray, width, height} || HTML5 Canvas ImageData */,
                {
                    barcode: 'code-2of5',
                    type: 'industrial', //optional type
                }
            )
            .then(code => {
                alert('code >> ', code)
            })
            .catch(err => {
                alert('err >> ', err)
            })
        }; 


        window.addEventListener("load", cameraStart, false);
    </script>
</body>

</html>


<style>
    html,
    body {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
    }

    #camera,
    #camera--view,
    #camera--sensor,
    #camera--output {
        position: fixed;
        height: 100%;
        width: 100%;
        object-fit: cover;
    }

    #camera--view,
    #camera--sensor,
    #camera--output {
        transform: scaleX(-1);
        filter: FlipH;
    }


    #camera--trigger {
        width: 200px;
        background-color: black;
        color: white;
        font-size: 16px;
        border-radius: 30px;
        border: none;
        padding: 15px 20px;
        text-align: center;
        box-shadow: 0 5px 10px 0 rgba(0, 0, 0, 0.2);
        position: fixed;
        bottom: 30px;
        left: calc(50% - 100px);
    }


    .taken {
        height: 100px !important;
        width: 100px !important;
        transition: all 0.5s ease-in;
        border: solid 3px white;
        box-shadow: 0 5px 10px 0 rgba(0, 0, 0, 0.2);
        top: 20px;
        right: 20px;
        z-index: 2;
    }
</style>